const https = require('https');
const fs   = require('fs');

// 抖音短链
const url = 'https://v.douyin.com/BYFyL-zfB7E/';

// 稳定接口（抗风控）
const api = `https://dy.2333.me/api?url=${encodeURIComponent(url)}`;

https.get(api, res => {
  let body = '';
  res.on('data', chunk => body += chunk);
  res.on('end', () => {
    try {
      const json = JSON.parse(body);
      const data = {
        date: new Date().toISOString(),
        title: json.data?.title || json.data?.desc || '无标题',
        description: json.data?.desc || '',
        author: json.data?.author?.nickname || ''
      };
      // 人为随机串，方便肉眼验证更新
      data.random = Math.random().toString(36).slice(2, 8);
      fs.writeFileSync('result.json', JSON.stringify(data, null, 2));
      console.log('OK');
    } catch (e) {
      console.error('解析失败', e);
      process.exit(1);
    }
  });
}).on('error', e => {
  console.error('请求失败', e);
  process.exit(1);
});
